test_that("runDySim produces correct output for P: L-APIM and S: L-APIM", {
  popModList.apim <- list(nItemsX = 5,
                          loadValuesX_A = "moderate", loadValuesX_B = "moderate",
                          residCorrValuesX = "moderate", iccX = "weak",
                          nItemsY = 5,
                          loadValuesY_A = "weak", loadValuesY_B = "mixed",
                          residCorrValuesY = "mixed", iccY = "strong",
                          actorA = "moderate", actorB = "very strong",
                          partnerA = "weak", partnerB = "weak")
  set.seed(123)
  expect_equal(runDySim(seed = 123,
                        popMod = "L-APIM",
                        popModList = popModList.apim,
                        sampSize = 100,
                        sampMod = "APIM",
                        sampModType = "latent",
                        nSims = 2,
                        output = "paramTable"),
               structure(list(pop_model = c("L-APIM", "L-APIM", "L-APIM", "L-APIM",
                                            "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM",
                                            "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM",
                                            "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM"),
                              samp_model = c("L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM",
                                             "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM",
                                             "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM",
                                             "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM",
                                             "L-APIM"), samp_n = c(100, 100, 100, 100, 100, 100, 100,
                                                                   100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100,
                                                                   100, 100, 100, 100, 100), lhs = c("YA", "YB", "YA", "YB",
                                                                                                     "k1", "k2", "YA", "YB", "YA", "YB", "k1", "k2", "YA", "YB",
                                                                                                     "YA", "YB", "k1", "k2", "YA", "YB", "YA", "YB", "k1", "k2"
                                                                   ), op = c("~", "~", "~", "~", ":=", ":=", "~", "~", "~",
                                                                             "~", ":=", ":=", "~", "~", "~", "~", ":=", ":=", "~", "~",
                                                                             "~", "~", ":=", ":="), rhs = c("XA", "XB", "XB", "XA", "p1/a1",
                                                                                                            "p2/a2", "XA", "XB", "XB", "XA", "p1/a1", "p2/a2", "XA",
                                                                                                            "XB", "XB", "XA", "p1/a1", "p2/a2", "XA", "XB", "XB", "XA",
                                                                                                            "p1/a1", "p2/a2"), label = c("a1", "a2", "p1", "p2", "k1",
                                                                                                                                         "k2", "a1", "a2", "p1", "p2", "k1", "k2", "a1", "a2", "p1",
                                                                                                                                         "p2", "k1", "k2", "a1", "a2", "p1", "p2", "k1", "k2"), est = c(-0.0549120119229995,
                                                                                                                                                                                                        0.415750311284535, -0.0142349924319804, 0.069289969045606,
                                                                                                                                                                                                        0.259232760437579, 0.166662458607721, 0.150800347632958,
                                                                                                                                                                                                        0.480510269812234, -0.161639408319174, -0.0848906409074196,
                                                                                                                                                                                                        -1.07187689455861, -0.176667693160006, 0.189948552552328,
                                                                                                                                                                                                        0.360059554516022, 0.166833173676143, 0.122937921912178,
                                                                                                                                                                                                        0.878307159672529, 0.341437743757212, -0.0249050166411704,
                                                                                                                                                                                                        0.840912277160698, 0.25699819804946, -0.0378740832810636,
                                                                                                                                                                                                        -10.3191337613731, -0.0450392797319403), se = c(0.139935080053524,
                                                                                                                                                                                                                                                        0.148767085894018, 0.140215778991522, 0.144132567827298,
                                                                                                                                                                                                                                                        2.4711018565607, 0.335998941327079, 0.136442590105336, 0.145426235779743,
                                                                                                                                                                                                                                                        0.136030380932957, 0.139419075601121, 1.17631023711616, 0.283588486322321,
                                                                                                                                                                                                                                                        0.133436111422878, 0.137682293750128, 0.133399902017623,
                                                                                                                                                                                                                                                        0.134354936280441, 0.965368174002974, 0.402594943792716,
                                                                                                                                                                                                                                                        0.145885386888526, 0.181691202955152, 0.150674745794287,
                                                                                                                                                                                                                                                        0.159827678476508, 59.9707287425893, 0.189048892549432),
                              z = c(-0.392410622854514, 2.79463907480661, -0.101522043627066,
                                    0.480737768639704, 0.1049057365844, 0.496020784915162, 1.10522929472782,
                                    3.30415118864794, -1.18825961678986, -0.608888278317757,
                                    -0.911219558189361, -0.622972023480563, 1.42351684657801,
                                    2.61514785023465, 1.25062440941001, 0.915023484180495, 0.90981574007206,
                                    0.848092478610481, -0.1707163217122, 4.62824981883282, 1.70564879133981,
                                    -0.236968237554864, -0.172069507537012, -0.238241436511793
                              ), pvalue = c(0.694754838305126, 0.00519576869796778, 0.919136059676198,
                                            0.630702884457495, 0.916450606952826, 0.619879746542468,
                                            0.269060246213779, 0.00095264441940146, 0.234731142487561,
                                            0.542598494261072, 0.362179700880569, 0.533302906533279,
                                            0.154586382002293, 0.00891888386723627, 0.21107154072573,
                                            0.360179301642093, 0.3629196922097, 0.396386470062214, 0.864446828361482,
                                            3.6876900555427e-06, 0.0880734893036863, 0.812681431277557,
                                            0.863382884646285, 0.811693840488839), ci.lower = c(-0.329179729001635,
                                                                                                0.124172180847282, -0.289052869319592, -0.213204672895174,
                                                                                                -4.58403788055145, -0.49188336523694, -0.116622214930862,
                                                                                                0.195480085276707, -0.428254055751035, -0.358147007843483,
                                                                                                -3.37740259395206, -0.732490912781984, -0.0715814200735869,
                                                                                                0.0902072174569076, -0.0946258298195699, -0.140392914342661,
                                                                                                -1.0137796931945, -0.447633846434439, -0.310835120813373,
                                                                                                0.484804063060843, -0.0383188770870712, -0.351130576827667,
                                                                                                -127.859602223469, -0.415568300446009), ci.upper = c(0.219355705155636,
                                                                                                                                                     0.707328441721788, 0.260582884455631, 0.351784610986386,
                                                                                                                                                     5.10250340142661, 0.825208282452382, 0.418222910196778, 0.765540454347761,
                                                                                                                                                     0.104975239112686, 0.188365726028644, 1.23364880483484, 0.379155526461972,
                                                                                                                                                     0.451478525178243, 0.629911891575137, 0.428292177171856,
                                                                                                                                                     0.386268758167016, 2.77039401253955, 1.13050933394886, 0.261025087531033,
                                                                                                                                                     1.19702049126055, 0.55231527318599, 0.27538241026554, 107.221334700723,
                                                                                                                                                     0.325489740982128), std.lv = c(-0.0548298953988842, 0.38443903980286,
                                                                                                                                                                                    -0.0142137051387564, 0.0640715555583362, 0.259232760437579,
                                                                                                                                                                                    0.166662458607721, 0.147949777516309, 0.434779758571094,
                                                                                                                                                                                    -0.158583948074818, -0.0768115369794196, -1.07187689455861,
                                                                                                                                                                                    -0.176667693160006, 0.183494156691019, 0.334960860043541,
                                                                                                                                                                                    0.161164231579794, 0.114368280300242, 0.878307159672529,
                                                                                                                                                                                    0.341437743757212, -0.024137739872474, 0.645291447389812,
                                                                                                                                                                                    0.249080566441288, -0.0290634620076183, -10.3191337613731,
                                                                                                                                                                                    -0.0450392797319403), std.all = c(-0.0548298953988842, 0.38443903980286,
                                                                                                                                                                                                                      -0.0142137051387564, 0.0640715555583362, 0.259232760437579,
                                                                                                                                                                                                                      0.166662458607721, 0.147949777516309, 0.434779758571094,
                                                                                                                                                                                                                      -0.158583948074818, -0.0768115369794196, -1.07187689455861,
                                                                                                                                                                                                                      -0.176667693160006, 0.183494156691019, 0.334960860043541,
                                                                                                                                                                                                                      0.161164231579794, 0.114368280300242, 0.878307159672529,
                                                                                                                                                                                                                      0.341437743757212, -0.024137739872474, 0.645291447389812,
                                                                                                                                                                                                                      0.249080566441288, -0.0290634620076183, -10.3191337613731,
                                                                                                                                                                                                                      -0.0450392797319403), std.nox = c(-0.0548298953988842, 0.38443903980286,
                                                                                                                                                                                                                                                        -0.0142137051387564, 0.0640715555583362, 0.259232760437579,
                                                                                                                                                                                                                                                        0.166662458607721, 0.147949777516309, 0.434779758571094,
                                                                                                                                                                                                                                                        -0.158583948074818, -0.0768115369794196, -1.07187689455861,
                                                                                                                                                                                                                                                        -0.176667693160006, 0.183494156691019, 0.334960860043541,
                                                                                                                                                                                                                                                        0.161164231579794, 0.114368280300242, 0.878307159672529,
                                                                                                                                                                                                                                                        0.341437743757212, -0.024137739872474, 0.645291447389812,
                                                                                                                                                                                                                                                        0.249080566441288, -0.0290634620076183, -10.3191337613731,
                                                                                                                                                                                                                                                        -0.0450392797319403)), row.names = c(NA, -24L), class = c("lavaan.data.frame",
                                                                                                                                                                                                                                                                                                                  "data.frame")))
})

test_that("runDySim produces correct output for P: L-APIM and S: L-APIM", {
  popModList.apim <- list(nItemsX = 5,
                          loadValuesX_A = "moderate", loadValuesX_B = "moderate",
                          residCorrValuesX = "moderate", iccX = "weak",
                          nItemsY = 5,
                          loadValuesY_A = "weak", loadValuesY_B = "mixed",
                          residCorrValuesY = "mixed", iccY = "strong",
                          actorA = "moderate", actorB = "very strong",
                          partnerA = "weak", partnerB = "weak")
  set.seed(123)
  expect_equal(runDySim(seed = 123,
                        popMod = "L-APIM",
                        popModList = popModList.apim,
                        sampSize = 100,
                        sampMod = "APIM",
                        sampModType = "observed",
                        nSims = 2,
                        output = "paramTable"),
               structure(list(pop_model = c("L-APIM", "L-APIM", "L-APIM", "L-APIM",
                                            "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM",
                                            "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM",
                                            "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM", "L-APIM"),
                              samp_model = c("O-APIM", "O-APIM", "O-APIM", "O-APIM", "O-APIM",
                                             "O-APIM", "O-APIM", "O-APIM", "O-APIM", "O-APIM", "O-APIM",
                                             "O-APIM", "O-APIM", "O-APIM", "O-APIM", "O-APIM", "O-APIM",
                                             "O-APIM", "O-APIM", "O-APIM", "O-APIM", "O-APIM", "O-APIM",
                                             "O-APIM"), samp_n = c(100, 100, 100, 100, 100, 100, 100,
                                                                   100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100,
                                                                   100, 100, 100, 100, 100), lhs = c("Y_A", "Y_B", "Y_A", "Y_B",
                                                                                                     "k1", "k2", "Y_A", "Y_B", "Y_A", "Y_B", "k1", "k2", "Y_A",
                                                                                                     "Y_B", "Y_A", "Y_B", "k1", "k2", "Y_A", "Y_B", "Y_A", "Y_B",
                                                                                                     "k1", "k2"), op = c("~", "~", "~", "~", ":=", ":=", "~",
                                                                                                                         "~", "~", "~", ":=", ":=", "~", "~", "~", "~", ":=", ":=",
                                                                                                                         "~", "~", "~", "~", ":=", ":="), rhs = c("X_A", "X_B", "X_B",
                                                                                                                                                                  "X_A", "p1/a1", "p2/a2", "X_A", "X_B", "X_B", "X_A", "p1/a1",
                                                                                                                                                                  "p2/a2", "X_A", "X_B", "X_B", "X_A", "p1/a1", "p2/a2", "X_A",
                                                                                                                                                                  "X_B", "X_B", "X_A", "p1/a1", "p2/a2"), label = c("a1", "a2",
                                                                                                                                                                                                                    "p1", "p2", "k1", "k2", "a1", "a2", "p1", "p2", "k1", "k2",
                                                                                                                                                                                                                    "a1", "a2", "p1", "p2", "k1", "k2", "a1", "a2", "p1", "p2",
                                                                                                                                                                                                                    "k1", "k2"), est = c(-0.0306934264880345, 0.250325728848689,
                                                                                                                                                                                                                                         -0.0602157802670168, -0.034618197089765, 1.96184613961205,
                                                                                                                                                                                                                                         -0.138292604795291, -0.0111344804747976, 0.0820135266464922,
                                                                                                                                                                                                                                         -0.00700001507052656, 0.0726497142052773, 0.628679091617321,
                                                                                                                                                                                                                                         0.885825999391828, 0.131558928924028, 0.26320489663308, 0.0649417922262328,
                                                                                                                                                                                                                                         -0.0119434163282345, 0.493632722289302, -0.0453768774100134,
                                                                                                                                                                                                                                         0.0945931530314264, 0.347149978947731, -0.0958743344338847,
                                                                                                                                                                                                                                         -0.0262390771933511, -1.01354412408721, -0.0755842684273988
                                                                                                                                                                                                                    ), se = c(0.0749655317692394, 0.105120664405426, 0.0798462870515836,
                                                                                                                                                                                                                              0.098694965014434, 5.42862326489595, 0.399111872903358, 0.0815460202567115,
                                                                                                                                                                                                                              0.10121443034573, 0.0826711729823848, 0.0998369043221762,
                                                                                                                                                                                                                              9.64926713247997, 1.82490124833162, 0.113307639473089, 0.0999851816369911,
                                                                                                                                                                                                                              0.0836790275519296, 0.135387387318105, 0.876620087702017,
                                                                                                                                                                                                                              0.508801744624887, 0.0787709356163533, 0.102197511216448,
                                                                                                                                                                                                                              0.0880727395482719, 0.0914039192770897, 1.22702700351336,
                                                                                                                                                                                                                              0.263195537672207), z = c(-0.409433852647317, 2.38131798599789,
                                                                                                                                                                                                                                                        -0.754146278938621, -0.350759505155122, 0.361389259095999,
                                                                                                                                                                                                                                                        -0.346500853981805, -0.136542291576531, 0.810294800517563,
                                                                                                                                                                                                                                                        -0.0846729859756326, 0.727683963144879, 0.0651530404315528,
                                                                                                                                                                                                                                                        0.48541037505546, 1.16107730719493, 2.63243905070532, 0.776082061732029,
                                                                                                                                                                                                                                                        -0.0882166098690739, 0.563109069954485, -0.0891838086040122,
                                                                                                                                                                                                                                                        1.20086364712149, 3.39685355167298, -1.08858126732094, -0.28706730959542,
                                                                                                                                                                                                                                                        -0.826016152199685, -0.287179141013911), pvalue = c(0.682221300660965,
                                                                                                                                                                                                                                                                                                            0.0172508135059055, 0.450761391067677, 0.725768779500888,
                                                                                                                                                                                                                                                                                                            0.717808476234153, 0.728966342531171, 0.891392593752607,
                                                                                                                                                                                                                                                                                                            0.417770762974235, 0.932521372889547, 0.466807069457751,
                                                                                                                                                                                                                                                                                                            0.948052149947415, 0.627385274254103, 0.245610462295918,
                                                                                                                                                                                                                                                                                                            0.0084774232020759, 0.437700534496866, 0.929704516018123,
                                                                                                                                                                                                                                                                                                            0.573360615737642, 0.928935832960002, 0.229804097779086,
                                                                                                                                                                                                                                                                                                            0.000681654371712526, 0.276338581244113, 0.774060782342643,
                                                                                                                                                                                                                                                                                                            0.408794929296972, 0.773975156998229), ci.lower = c(-0.177623168837637,
                                                                                                                                                                                                                                                                                                                                                                0.0442930125831323, -0.216711627187368, -0.228056773973496,
                                                                                                                                                                                                                                                                                                                                                                -8.67805994522024, -0.920537501488201, -0.170961743260526,
                                                                                                                                                                                                                                                                                                                                                                -0.116363111546877, -0.169032536675681, -0.123027022594159,
                                                                                                                                                                                                                                                                                                                                                                -18.2835369652495, -2.69091472268033, -0.0905199636164753,
                                                                                                                                                                                                                                                                                                                                                                0.0672375416368814, -0.0990660880368841, -0.277297819432696,
                                                                                                                                                                                                                                                                                                                                                                -1.22451107773099, -1.04260997214594, -0.0597950438051495,
                                                                                                                                                                                                                                                                                                                                                                0.146846537653864, -0.268493731968274, -0.205387467022253,
                                                                                                                                                                                                                                                                                                                                                                -3.41847285903149, -0.591438043156579), ci.upper = c(0.116236315861568,
                                                                                                                                                                                                                                                                                                                                                                                                                     0.456358445114245, 0.096280066653334, 0.158820379793966,
                                                                                                                                                                                                                                                                                                                                                                                                                     12.6017522244443, 0.643952291897618, 0.148692782310931, 0.280390164839861,
                                                                                                                                                                                                                                                                                                                                                                                                                     0.155032506534628, 0.268326451004714, 19.5408951484841, 4.46256672146398,
                                                                                                                                                                                                                                                                                                                                                                                                                     0.353637821464532, 0.459172251629278, 0.22894967248935, 0.253410986776227,
                                                                                                                                                                                                                                                                                                                                                                                                                     2.2117765223096, 0.951856217325911, 0.248981349868002, 0.547453420241598,
                                                                                                                                                                                                                                                                                                                                                                                                                     0.0767450631005047, 0.152909312635551, 1.39138461085707,
                                                                                                                                                                                                                                                                                                                                                                                                                     0.440269506301782), std.lv = c(-0.0306934264880345, 0.250325728848689,
                                                                                                                                                                                                                                                                                                                                                                                                                                                    -0.0602157802670168, -0.034618197089765, 1.96184613961205,
                                                                                                                                                                                                                                                                                                                                                                                                                                                    -0.138292604795291, -0.0111344804747976, 0.0820135266464922,
                                                                                                                                                                                                                                                                                                                                                                                                                                                    -0.00700001507052656, 0.0726497142052773, 0.628679091617321,
                                                                                                                                                                                                                                                                                                                                                                                                                                                    0.885825999391828, 0.131558928924028, 0.26320489663308, 0.0649417922262328,
                                                                                                                                                                                                                                                                                                                                                                                                                                                    -0.0119434163282345, 0.493632722289302, -0.0453768774100134,
                                                                                                                                                                                                                                                                                                                                                                                                                                                    0.0945931530314264, 0.347149978947731, -0.0958743344338847,
                                                                                                                                                                                                                                                                                                                                                                                                                                                    -0.0262390771933511, -1.01354412408721, -0.0755842684273988
                                                                                                                                                                                                                                                                                                                                                                                                                     ), std.all = c(-0.0407969038132327, 0.231512228763917, -0.0751448201071653,
                                                                                                                                                                                                                                                                                                                                                                                                                                    -0.0341009118799235, 1.84192458455124, -0.147296374200162,
                                                                                                                                                                                                                                                                                                                                                                                                                                    -0.0140827242288128, 0.0829377529057769, -0.00873301815398797,
                                                                                                                                                                                                                                                                                                                                                                                                                                    0.0744821177308027, 0.620122783922766, 0.898048417292179,
                                                                                                                                                                                                                                                                                                                                                                                                                                    0.121651065762161, 0.26963769993117, 0.0813134572035402,
                                                                                                                                                                                                                                                                                                                                                                                                                                    -0.00903592574135734, 0.668415493889016, -0.0335113589222276,
                                                                                                                                                                                                                                                                                                                                                                                                                                    0.118737474892312, 0.32196575565254, -0.107635359939981,
                                                                                                                                                                                                                                                                                                                                                                                                                                    -0.0272092516945603, -0.906498643647262, -0.0845097691815526
                                                                                                                                                                                                                                                                                                                                                                                                                     ), std.nox = c(-0.0407969038132327, 0.231512228763917, -0.0751448201071653,
                                                                                                                                                                                                                                                                                                                                                                                                                                    -0.0341009118799235, 1.84192458455124, -0.147296374200162,
                                                                                                                                                                                                                                                                                                                                                                                                                                    -0.0140827242288128, 0.0829377529057769, -0.00873301815398797,
                                                                                                                                                                                                                                                                                                                                                                                                                                    0.0744821177308027, 0.620122783922766, 0.898048417292179,
                                                                                                                                                                                                                                                                                                                                                                                                                                    0.121651065762161, 0.26963769993117, 0.0813134572035402,
                                                                                                                                                                                                                                                                                                                                                                                                                                    -0.00903592574135734, 0.668415493889016, -0.0335113589222276,
                                                                                                                                                                                                                                                                                                                                                                                                                                    0.118737474892312, 0.32196575565254, -0.107635359939981,
                                                                                                                                                                                                                                                                                                                                                                                                                                    -0.0272092516945603, -0.906498643647262, -0.0845097691815526
                                                                                                                                                                                                                                                                                                                                                                                                                     )), row.names = c(NA, -24L), class = c("lavaan.data.frame",
                                                                                                                                                                                                                                                                                                                                                                                                                                                            "data.frame")))
})
